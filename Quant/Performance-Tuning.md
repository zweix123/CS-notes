Note：
对于一个月的数据
+ 打日志：1300s
+ 不打日志：800s
+ 不assert：760s
+ 数据同时读入（但assert）：700s
+ 清空add_log函数内容（疑似目前唯一的系统调用gitpid来自于此）（但assert）：180
+ 优化find_enum的过程（但assert）：150

---

>背景：使用Python开发一套量化交易系统，需求：实现实盘、虚拟盘交易和回测，对于数字货币期货交易，对于策略类型为轮询形。  
>在功能实现后发现很慢，进行调优。

## 代码层面

+ 枚举：在用户层面没有使用枚举类（比如币种类型），而是使用字符串，但是在回测系统内部使用枚举类，需要转换，之前的方案是暴力跑一遍，因为当时考虑的是每个枚举类都很小，可能就几个量，但是忘记了关于币种类型的枚举（几百），于是对于币种枚举的转换特殊处理，将循环换成哈希表。

## 减少系统调用

+ 关于数据的读入，没有使用任何数据库，因为数据由K线组成，使用能得到的最精细K线是分钟K线，一条K线数据可以用六元祖描述，以每500条一个存储在csv文件中，一条K线的三年数据在30M左右，但是所有K线的所有币种的数据是30G。考虑只需要顺序读，之前就是每一个每一个文件的读入，用完一个文件的数据在读新的。调整为全部读入（因为内存30M没有任何问题）。原因是整个回测过程中是很计算密集的，一个读入的中断会打断如此热的缓存

## 方法

+ perf和火焰图