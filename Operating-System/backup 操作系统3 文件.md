# 文件
+ 定义：一组有意义的数据集合
+ 属性：
	+ 文件名：同一目录下不允许有重名文件
	+ 标识符：用于操作系统区分文件
	+ 文件类型：
	+ 文件位置：文件存放路径（用户使用）、在外存中的地址（操作系统可见，用户不可见）
	+ 创建时间、上次修改时间
	+ 文件所有者信息、保护信息

+ How管理：树状组织
	>目录是特殊的有结构的文件

+ 操作系统和文件的关系（操作系统自下而上为文件提供了什么功能）
	+ 创建目录：`create`系统调用
	+ 删除文件：`delete`
	+ 读文件：`read`系统调用
	+ 写文件：`write`系统调用
	+ 打开文件：`open`
	+ 关闭文件：`close`
	其他操作是上述几种基本功能的组合

+ 存储：
	+ 外存：一个个存储单元组成，有大小、有位置
	+ 存储单元/块/磁盘块/物理块：大小相等，是二的整数次幂
		>操作系统是以块为单位为文件分配地址的

	文件的逻辑地址为：逻辑块好、块内地址，操作系统将其转换成外存的物理地址、块内地址

## 文件内部组织
+ 分类：
	+ 无结构文件/流式文件    ：由二进制或字符流组成
	+ 有结构文件/记录式文件：由一组相似的记录组成，每条记录有一个数据项作为关键字
		+ **数据项**：文件系统中最基本的数据单位
		+ **记录**：一组相关数据项的集合

1. 顺序文件：文件中的记录逻辑上顺序排列
	+ 记录的类型：
		+ 定长记录
		+ 可变长记录
	+ 记录的存储：
		+ 顺序存储：逻辑相邻则物理相邻
		+ 串结构：记录之间的顺序与关键字无关，按照存入时间
		+ 顺序结构：记录之间的顺序按关键字排序
		+ 链式存储：
	+ 内容查找：
		+ 链式存储：不能随机存取
		+ 顺序存储：
			+ 可变记录：不能随机存储
			+ 定长记录：可以随机存储
		+ 串结构：不能通过关键字访问
		+ 顺序结构：可以通过关键字访问（二分）
+ 文件修改和删除：同数据结构

2. 索引文件
	>解决可边长记录访问慢的问题

	建立一张索引表以加快文件索引速度，每条记录对应一个索引项
	索引表字段：索引号、长度m、指针ptr，且长度固定，所以索引表本身就是定长记录的顺序文件，如果顺序结构可快速检索
	>索引表本身可能很大

3. 索引顺序文件：同样建立索引表，但是先将记录分组，再对每组建立索引  
	索引表字段：键、地址：顺序存储定长记录的串结构的文件，插入更快
## 文件外部组织
### 文件目录
FCB的有序集合
>FCB：文件目录项，包含文件的基本信息：文件名、文件存放的物理地址，实现文件名和文件之间的映射，使用户可以按名存取

+ 支持的操作：搜索、创建、删除、显示、修改

+ 目录的发展：
	1. 单极目录结构：整个系统只有一张目录表，不允许文件重名
	2. 两级目录结构：分为Master File Directory主文件目录和User File Directory用户文件目录：允许不同用户之间文件名可重复，同时可实现文件权限，但是
	3. 多级目录结构（树形）：
		+ 缺点：不方便实现文件共享
	4. DAG目录结构：不同文件名指向同一文件/目录  
		为每个共享结点设置一个共享计数器



+ 索引结点

### 物理存储管理
外存硬盘空间是一个个块、文件的逻辑地址也是块：`(逻辑块号, 块内地址)` -> `物理块号, 块内地址`

1. 连续分配：要求每个文件在磁盘上占有一组连续的块：具体位置可以之间通过块的大小进行计算来随机访问
	+ 优点：快
	+ 缺点：存储空间利用率低，会产生磁盘碎片
2. 链接分配：每个文件描述为起始块号和末尾块号
	1. 隐式链接：除了最后一个磁盘块都有一个地方存储指针指向下一个块的地址
	2. 显式链接：每个点的指向保存在一个表上（FAT文件分配表：不需要访问磁盘，可以先计算再过去，相当于随机访问  
		该表常驻内存，快，但占空间
3. 索引分配：允许文件离散的分配在各个磁盘块  
	为每个文件建立一张索引表，记录文件的各个逻辑块对应的物理块  
	索引表存放的磁盘块叫索引块，文件数据存放的磁盘块叫数据块
	+ 支持随机访问：随机到表、直接去存储
	+ 容易扩展

### 逻辑存储管理
+ 文件卷/逻辑卷：每个盘分成两个区

1. 空闲表法：空间盘块表：第一个空闲盘块号+空间盘块树的表：用于连续分配方法
	+ 分配：首次、最佳、最坏适应
	+ 回收：
		1. 回收区前后没有相邻空闲区
		2. 前后都是
		3. 前面是
		4. 后面是

2. 空间链表法：操作系统保存链头、链尾指针
	1. 空间盘块链：每个空间块都是链表的结点
		+ 回收：不必考虑前后顺序
	2. 空闲盘区链：一段连续的空间的块是结点
		+ 回收：也要考虑前后

3. 位示图法：直接把整个硬盘看成一个二维地图，做个bool
4. 成组链接法

## 文件操作
1. create创建文件：调用create系统调用
	+ args:
		+ 所需的外存空间大小
		+ 文件存放路径
		+ 文件名
	+ OS:
		1. 在外存中找到文件所需的空间
2. delete：
	+ args:
		+ 路径
		+ 文件名
	+ OS:
		1. 找到
		2. 回收磁盘块
		3. 删除对应目录项

3. open：
	+ args：
		+ 路径
		+ 名
		+ 操作类型
	+ OS:
		1. 找到
		2. 确定权限
		3. 将目录项复制到“打开文件表”
			+ 用户打开文件表
			+ 系统打开文件表

4. read

5. write

## 文件共享
共享和复制的区别：共享是一个文件

1. 基于索引结点的共享方式（硬链接）：不同用户的目录是文件名和索引结点组成的表，多个用户的索引结点指针指向同一个物理地址，索引结点设置链接计数变量count
2. 基于基于符号链的共享方式（软链接）：不同用户的索引结点指针指向的是一个Link类型的文件，这个文件里存放的是目标文件的地址

## 文件保护
1. 口令保护：使用密码访问，口令存放在文件对应对的PCB或索引结点的  
	只有密码才能访问
	+ 优点：时间空间开销小
	+ 缺点：在系统内部，不够安全

2. 加密保护：对密码进行加密，有密码才能解密
3. 访问控制：在每个文件的PCB或者索引结点添加一个访问控制表Access-Control List, ACL，该表中记录各个用户可以对该文件执行哪些操作

# 磁盘
+ 磁头、磁盘、磁道、扇区/磁盘块
	+ 盘面：一个盘片有两个盘面
	+ 柱面：多个盘面相对位置相同的磁道
	+ 磁盘块：每个磁盘块的存储空间一样，但是里面的面积更小，说明里面的信息密度更大

+ 读写：把磁头移动到对应扇区，然后移动到对应磁道，然后旋转
	+ 定位：三元组（柱面号，盘面好、扇区号）
	1. 根据柱面号移动到对应磁道
	2. 激活对应磁盘磁头
	3. 读写

+ 磁头分类：
	+ 活动头磁盘：磁臂移动定位磁道
	+ 固定头磁盘：每个磁道都有一个磁头

## 磁盘调度
+ 我们梳理一次磁盘读写操作的时间：
	+ 寻找磁道时间：
		+ 启动磁头臂时间
		+ 移动磁头时间
	+ 延迟时间：旋转磁盘使磁头定位到目标扇区所需要的时间
	+ 传输时间：从磁盘读出或向磁盘写入数据所经历的时间
后两项与硬件相关，操作系统无法管理，只有第一项可以，所以有不同的磁盘调度算法

1. 先来先服务算法FCFS：根据进程请求访问磁盘的先后顺序进行调度
2. 最短寻找时间优先SSTF：优先处理与当前磁头最近的磁道的磁道请求（可能产生饥饿）
3. 扫描算法SCAN，又叫电梯算法：为了避免贪心的饥饿，只有磁头移动到最外侧时才能往里面移动，反之亦然
	+ 缺点：这里指的“头”是指整个扇区的边缘，而不是这一趟的最边缘，不够只能
	+ 缺点：对于各个磁道的响应频率不均匀
4. LOOK调度算法：在扫描算法的基础上，如果当前移动方向、再移动也没有请求，就反向
5. 循环扫错算法C-SCAN：只有往某个特点方向移动时才处理磁道访问请求，返回时快速移动至起始端而不处理请求
6. C-LOOK调度算法

## 磁盘管理