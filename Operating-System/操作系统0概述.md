

# 概述

+ 定义：操作系统(Operating System, OS)：是指控制和管理整个计算机系统的硬件和软件资源，并合理地组织调度计算机的工作和资源的分配，以提供给用户和其他软件方便的接口和环境，它是计算机系统中最基本的**系统软件**。

  1. 作为系统资源的管理者：负责安全、高效地文件管理、存储器管理、处理器管理和设备管理。

  2. 作为用户和计算机硬件之间的接口：

     > 1. 命令接口：允许用户直接使用，面向用户
     >    + 联机命令接口/交互式命令接口
     >    + 脱机命令接口/批处理命令接口
     > 2. 程序接口/系统调用/广义调用：只能用户通过程序间接使用，面向程序
     > 3. Graphical User Interface(GUI)图形用户界面
     >

  + 系统调用：软件的运行需要硬件的配合，但是狼多肉少，操作系统规定一些接口，通过管理接口的调用情况来管理硬件

  3. 作为最接近硬件的层次：裸机->虚拟机（覆盖软件的裸机）

+ 特征：

  1. 并发性：指两个或多个事件在同一时间间隔内发生，这些事件宏观上是同时发生的，但是微观上是交替发生的

     > 并行：指两个或多个事件在同一时刻同时发生

  2. 共享：资源共享，系统中的资源可供内存中多个并发执行的进程共同使用，分为互斥共享方式和同时共享方式

  3. 虚拟：把一个物理上的实体变成若干个逻辑上的对应物，物理实体实际存在，逻辑对应物为用户视角

     + 空分复用技术：虚拟存储
     + 时分复用技术：虚拟处理器

  4. 异步：在多道程序环境下，运行多个程序并发执行，每个程序不是一贯到底，而是你方唱罢我登场

+ 发展历史：

  | 发展阶段       | 说明                                                         | 特点                                                   |
  | -------------- | ------------------------------------------------------------ | ------------------------------------------------------ |
  | 手工操作阶段   | 以纸带为人机交互媒介<br>人在纸带上刻录信息<br>计算机处理纸带上的信息<br>人查看纸带上处理好的信息 | （单个）用户独占全机<br>人机速度矛盾导致资源利用率极低 |
  | 单道批处理系统 | 引入脱机输入/输出技术<br>将纸带通过外围机读入/输出到磁带<br>计算机处理磁带 | 缓解人机速度矛盾<br>只能串行执行                       |
  | 多道批处理系统 | 计算机对磁带地处理可并发                                     | 有了并发性和共享性<br>没有人机交互                     |
  | 分时操作系统   | 以时间片为单位轮流为各个用户、作业服务                       | 不能优先处理紧急任务                                   |
  | 实时操作系统   | 优先相对地紧急任务<br>一个任务必须在时限内完成               | 及时性和可靠性                                         |

  + 并发的优势：一个程序的执行需要硬件的多个部分（输入、计算、输出），串行是围绕任务，硬件只在需要自己的时候运行，并发围绕硬件，每个硬件尽快的处理需要自己的。提高整体效率
  + 关于实时操作系统：
    + 硬实时系统：导弹
    + 软实时系统：网站
  + 其他操作系统分类：
    + 网络操作系统
    + 分布式操作系统
    + 个人计算机操作系统

## 体系结构

1. 指令有不同的“权重”：

   + 特权指令
   + 非特权指令

2. 机器通过处理器状态决定程序是否有权执行特定的指令：

   > 使用 程序状态字寄存器PSW 中的某个标志位来表示当前处理器处于什么状态

   + 用户态（目态）：只能执行非特权指令

   + 核心态（管态）：两种命令都可以执行

     > 指令：从用户态进入核心态，这个指令在核心态不能用

   > 用户态$\rightarrow$核心态：只有“中断”
   >
   > 核心态$\rightarrow$用户态：修改 程序标志字 的特权指令

3. 程序因该状态不同而有不同分类：

   + 内核程序
   + 应用程序

+ 操作系统内核操作：
  + 和硬件关系密切：
    + 时钟管理
    + 中断处理
    + 原语：最接近硬件的程序，具有原子性
  + 其他：
    + 进行文件管理、存储器管理、处理器管理、设备管理

4. 根据内核程序判定的不同分为：

   + 微内核：只有和硬件关系密切的程序认为是内核程序，具有核心态
   + 大内核/宏内核：

   |      | 微内核                                         | 大内核               |
   | ---- | ---------------------------------------------- | -------------------- |
   | 优点 | 内核程序少：短小精悍                           | 与之相反             |
   | 缺点 | 与之相反，需要多次在用户态和内核态切换，执行慢 | 内核态程序多，执行快 |
   
   + 混合内核：内核中抽象出微内核的概念，其他模块在内核中的小型内核基础上搭建。整个内核是个完整的程序

## 中断

发生中断，意味着需要操作系统介入进行管理，而操作系统的管理通常需要特权指令，故CPU需要从用户态转为核心态，中断就是切换的过程，使操作系统获得计算机控制权，从而有了并发。

+ 内中断/异常、例外、陷入：信号来源于CPU内部，与当前执行的指令有关

  + 自愿中断
  + 强迫中断
    + 硬件故障
    + 软件中断

  > 其他内中断分类方式：
  >
  > + trap陷入：通过系统调用，是主动的
  > + fault故障：错误条件引起的，是可修复的
  > + abort终止：是不可恢复的（不会再将控制权给到引发终止的程序）

+ 外中断（广义上的中断）：信号来源于CPU外部，与当前执行的指令无关

  + 外设请求
  + 人工干预

  1. 每次执行指令，CPU都会检查是否有外部中断信号
  2. 如果监测到，则保护中断进程的CPU环境
  3. 转入中断处理程序
  4. 恢复保存的进程环境，退出中断，继续执行
