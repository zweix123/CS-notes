# 总线

+ 总线是一组能为多个部件**分时** **共享**的**公共**信息传送线路

  + 共享：多个部件
  + 分支：同时只能有一个在发送，（但是可以有多个在接收）

+ 特性：

  + 机器特性：尺寸、形状、管脚数、排列顺序等
  + 电气特性：传输方向（单双工否）和有效的电平范围
  + 功能特性：每根传输线的功能（地址、数据、控制）：含义
  + 时间特性：信号的时序关系

+ 分类

  1. 按数据传输格式

     + 串行总线：

       优点：只需要一根线，成本低，用于远距离传输，在计算机内部也能节省布线空间

       缺点：数据的发送和接收需要进行转换

     + 并行总线：

       优点：总线逻辑结点

       缺点：需要更多的线，导致空间更多，成本更高

       > 还有一点，当频率较高时，并行的信号线之间可能受到影响

  2. 按总线功能分类（连接的部件）

     + 片内总线：用于芯片内部，比如寄存器和寄存器、寄存器和ALU

     + 系统总线：计算机系统内不功能不限之间相互连接的总线

       > 系统总线按传输内部的不同，还能继续分类

       | 种类     | 说明                                                         | 位数                     | 方向 |
       | -------- | ------------------------------------------------------------ | ------------------------ | ---- |
       | 数据总线 | 传输各功能部件之间的数据信息                                 | 与机器字长、存储字长有关 | 双向 |
       | 地址总线 | 指出数据总线上的源数据或目的数据所在的主存单元或I/O端口端地址 | 与主存地址空间的大小有关 | 单向 |
       | 控制总线 | CPU送出的控制命令和主存（或外设）返回CPU的返回信号           |                          |      |

     + 通信/外部总线：用于计算机系统和其他系统之间信息传送的总线

  3. 按时序控制方式

     + 同步总线
     + 异步总线

## 系统总线

> 下面讨论的数据不是总线的根数，里面有各类总线

+ 单总线：

  + 优点：结构结点，成本低，易于接入新设备
  + 缺点：带宽低、负载重，不支持并发

+ 双总线：主存总线 + I/O总线：

  > 两者的连接——通道：特殊的处理器，对I/O设备进行统一管理，程序存在主存中

  1. 主存总线：支持突发/猝发传送：送出一个地址，收到多个地址连续的数据

  + 优点：讲较低速的I/O设备从单总线上分离，实现存储器总线和I/O总线分离
  + 缺点：需要增加通道等硬件设备

+ 三总线结构：![](https://cdn.jsdelivr.net/gh/zweix123/CS-notes@master/source/Computer-Organization&Architecture/三总线结构.jpg)
+ 四总线结构：
  + 桥接器：用于连接不同的总线，具有数据缓冲、转换和控制功能
  + 靠近CPU的总线速度较快

## 性能指标

1. 时钟周期：机器的时钟周期，计算机系统的统一时钟
2. 时钟频率：机器的时钟频率，时钟周期的倒数，含义是一秒内有多少个时钟周期
3. 传输周期（总线周期）：一次总线操作所需的时间（申请、寻址、传输和结束），包含若干个总线时钟周期（通常，因为甚至可以一个时钟周期多个操作）
4. 工作频率：总线上各种操作的频率，为总线周期的倒数



1. 总线宽度/位宽：总线上同时能传输的数据的位数，通常是数据总线的根数
2. 总线带宽：总线的数据传输率，即单位时间内总线上可传输数据的位数。单位$B/s$

> $$
> 总线带宽 &= 总线工作频率 \times 总线宽度 (bit / s) &= 总线工作频率 \times (总线宽度 / 8) (B/s) \hfill \\
>         &= \frac{总线宽度}{总线周期}(bit / s) \hfill &= \frac{总线宽度 / 8}{总线周期}(B/s) \hfill
> $$
>
> 总线带宽是指总线本身所能达到的最高传输速率，不同于
>
> 有效数据传输率：实际传输的数据量除以耗时



1. 总线复用：一种信号线在不同的时间传输不同的信息，可以用较少的线传输更多的信息，节省空间和成本
2. 信号线数：各类总线的线的总和

## 总线仲裁

+ 定义：
  + 主设备：获得总线控制权的设备
  + 从设备：被主设备访问的设备，只能响应从主设备发来的各种总线命令
+ 总线仲裁：当多个主设备同时竞争主线控制权时，以某种方式选择一个主设备优先获得总线控制权

+ 分类：

  + 集中仲裁方式：

    1. 主设备发出请求信号
    2. 若多个主设备用时要使用主线，**总线控制器**判优、仲裁逻辑确定优先等级顺序
    3. 主设备依次使用

    ![](https://cdn.jsdelivr.net/gh/zweix123/CS-notes@master/source/Computer-Organization&Architecture/集中仲裁.jpg)

    + 链式查询方式：提供三个总线：BG总线允许线、BR总线请求线、BS总线忙线：其中的总线允许线**串联**主设备

      总线控制部件接收总线请求，有则通过总线允许顺序允许，如果设备设备被允许，向总线忙输出信号。

      优先级：距离总线控制器的距离，近则高

      + 特点：优先级固定

        优点：简单、扩展容器

        缺点：对硬件电路的故障敏感，优先级不能改变，优先级高的部件频繁申请，可能cover低优先级

    1. 计数器定时查询方式：使用三个总线：BR总线请求，BS总线忙，设备地址：都是以总线方式与部件相连

       > 这里的设备地址线是以各个位数的方式，所以是log的

       当总线控制器接收到请求时，开始计数，并通过设备地址线送给各个部件，如果与本主设备一致，则获得控制权，终止计数

       + 特点：

         优点：通过设计计数起点（可由程序设置）、方式等等控制优先级

         对电路故障没有链式敏感

    2. 独立请求方式：

       每个设备分别向总线控制器有一份BR总线请求，BG总线控制，在总线控制器内有**排队器**，还有一根BS线用于设备通知总线控制器使用完毕

       + 优点：响应速度快、对优先级控制灵活
       + 确定：控制线数多、逻辑复杂

  + 分布仲裁方式：

    特点: 和 每个潜在的主模块都有自己的仲裁器和仲裁号，多个仲裁器竞争使用总线。

    当设备有总线请求时，它们就把各自唯一的仲裁号发送到共享的仲裁总线上;
    每个仲裁器将从仲裁总线上得到的仲裁号与自己的仲裁号进行比较;

    如果仲裁总线上的号优先级高，则它的总线请求不予响应，并撤销它的仲裁号;
    最后，获胜者的仲裁号保留在仲裁总线上。

## 操作和定时

+ 总线周期的四个阶段：
  1. 申请分配阶段：

https://www.bilibili.com/video/BV1BE411D7ii?p=88&spm_id_from=pageDriver

+ 同步定时方式（同步通信）
+ 异步定时方式（异步通信）
+ 半同步通信
+ 分离式痛惜



## 总线标准

+ 基本概念：规范
  + 系统总线标准：。。。
  + 设备总线标准：。。。
  + 局部总线标准：。。。
